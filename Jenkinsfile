pipeline{
    agent any
    environment{
        registry = "lamecoder/malysis"
        registryCredential = 'docker-hub-credentials'        
    }
    
    stages{
        stage ('Cloning') { 
                steps { 
                    echo 'Cloning repository'
                    checkout scm
                }
            }
       stage('Building image') {
          steps{
            script {
              dockerImage = docker.build("malysis:${env.BUILD_ID}")
            }
          }
        }
        stage ('Test') { 
            steps { 
                echo 'Testing build' 
            }
         }
       stage('Deploy Image') {
          steps{
             script {
                docker.withRegistry('', registryCredential) {
                    sh 'docker tag ${dockerImage} lamecoder/malysis'
                dockerImage.push('latest')
                }
            }
          }
        }
    }
}
