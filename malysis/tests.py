from django.test import TestCase
import sys
import os

def checkPdfId(file):
    import pdfid_PL as pdfid
    _, cleaned = pdfid.PDFiD(file, raise_exceptions=True,force=True, return_cleaned=True,)
    return cleaned

def checkOleId(file):
    import oleid
    mal, _ = oleid.Main(file)
    return mal

def checkMraptor(file):
    import mraptor
    return mraptor.Main(file)

def checkOleObj(file):
    import oleobj
    return oleobj.Main(file)
    

class TestCases(TestCase):
    script_dir = os.path.dirname( __file__ )
    pathOfLibraries = os.path.join(script_dir, 'libraries')

    pdfIdPath = os.path.join(pathOfLibraries, 'pdfid_PL-0.0.11b')
    sys.path.append(pdfIdPath)

    oletoolsPath = os.path.join(pathOfLibraries, 'oletools-0.60.1', 'oletools')
    sys.path.append(oletoolsPath)

    def testHomePage(self):
        print('Checking if website can be accessed')
        response = self.client.get('/')
        self.assertEqual(response.status_code, 200)

    def testCheckPDFid(self):
        print('Checking PDFiD')
        self.assertEqual(checkPdfId(os.getcwd()+r'\media\files\Covid_Negative.pdf'), False)

    def testCheckOLEiD(self):
        print('Checking OLEiD')
        self.assertEqual(checkOleId(os.getcwd()+r'\media\files\Lab_Report.docx'), True)

    def testCheckMraptor(self):
        print('Checking Mraptor')
        self.assertNotEqual(checkMraptor(os.getcwd()+r'\media\files\Document1.rtf'), 'Suspicious')

    def testCheckOleObj(self):
        print('Checking OleObj')
        self.assertEqual(checkOleObj(os.getcwd()+r'\media\files\Lab-Assignment-1.doc'), 0)

    
    

